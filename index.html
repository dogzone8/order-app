<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Î™®Î∞îÏùº Ï£ºÎ¨∏ Ïï±</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <style>
    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      margin: 0;
      padding: 10px;
      background: #f9f9f9;
    }

    header {
      position: sticky;
      top: 0;
      background: white;
      z-index: 100;
      padding: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #ccc;
      flex-wrap: wrap;
    }

    h1 {
      font-size: 18px;
      margin: 0;
    }

    #clearBtn, #ordersBtn {
      font-size: 15px;
      padding: 8px 12px;
      margin: 5px;
      border: none;
      background: #007aff;
      color: white;
      border-radius: 6px;
      cursor: pointer;
    }

    #clearBtn:hover, #ordersBtn:hover {
      background: #005bb5;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
      margin-top: 10px;
      background: white;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      vertical-align: middle;
    }

    select, input[type="number"] {
      width: 100%;
      padding: 6px;
      font-size: 14px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }

    input[type="number"]::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    .sort-btn {
      font-size: 13px;
      padding: 4px 8px;
      margin-left: 6px;
      border: none;
      background: #eee;
      border-radius: 4px;
      cursor: pointer;
    }

    .vendor-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
    }

    @media (max-width: 480px) {
      th, td {
        font-size: 13px;
        padding: 6px;
      }

      h1 {
        font-size: 16px;
      }

      #clearBtn, #ordersBtn {
        font-size: 14px;
        padding: 6px 10px;
      }

      .sort-btn {
        font-size: 12px;
        padding: 3px 6px;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Î™®Î∞îÏùº Ï£ºÎ¨∏ Ïï±</h1>
    <div>
      <button id="ordersBtn" onclick="goToOrders()">üìã Ï£ºÎ¨∏ ÎÇ¥Ïó≠ Î≥¥Í∏∞</button>
      <button id="clearBtn" onclick="clearVendorAndQty()">üßπ ÌÅ¥Î¶¨Ïñ¥</button>
    </div>
  </header>

  <table id="orderTable">
    <thead>
      <tr>
        <th>
          <div class="vendor-header">
            Ï∂îÏ≤ú Î≤§Îçî
            <button class="sort-btn" onclick="toggleRowSort()">üî§ Ï†ïÎ†¨</button>
          </div>
        </th>
        <th>ÌíàÎ™©</th>
        <th>Î≤§Îçî</th>
        <th>ÏàòÎüâ</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>

  <script>
    const vendors = ["Mutual", "Nishimoto", "Restaurant Depot", "True World", "Sam's Club", "Pacific", "Walmart", "H-Mart"];
    const itemsOriginal = ["Tuna Blue fin", "Tuna Yellow Fin", "Ground Tuna", "Escolar", "Smoked Salmon", "Unagi", "Sushi Ebi", "Octopus", "Chashu", "Naruto Maki", "Green Mussel", "Ikura", "Tobiko(orange)", "Tamago", "kani", "Mackerel", "Baby Scallop", "Ama Ebi", "Ika", "Hokkigai", "Snow Crab Leg", "Tsubugai", "Inari", "Scallop 3s", "Salmon", "Yellowtail", "Albacore Tuna", "Uni", "Madai", "Gyoza Veggi", "Gyoza Chicken", "Gyoza Pork", "Gyoza Beef"];

    let orders = JSON.parse(localStorage.getItem("orders") || "{}");
    let vendorSelections = JSON.parse(localStorage.getItem("vendorSelections") || "{}");
    let useSortedRows = false;

    function createDropdown(options, defaultValue = "", onChangeCallback = null) {
      const select = document.createElement("select");
      options.forEach(opt => {
        const option = document.createElement("option");
        option.value = opt;
        option.textContent = opt;
        select.appendChild(option);
      });
      select.value = defaultValue;
      if (onChangeCallback) {
        select.onchange = () => onChangeCallback(select.value);
      }
      return select;
    }

    function updateOrder(vendor, item, qty) {
      if (!orders[vendor]) orders[vendor] = {};
      orders[vendor][item] = qty;
      localStorage.setItem("orders", JSON.stringify(orders));
    }

    function updateVendorSelection(item, vendor) {
      vendorSelections[item] = vendor;
      localStorage.setItem("vendorSelections", JSON.stringify(vendorSelections));
    }

    function getSortedItemsByVendor() {
      return [...itemsOriginal].sort((a, b) => {
        const va = vendorSelections[a] || "";
        const vb = vendorSelections[b] || "";
        return va.localeCompare(vb);
      });
    }

    function initTable() {
      const tbody = document.getElementById("tableBody");
      tbody.innerHTML = "";

      const items = useSortedRows ? getSortedItemsByVendor() : itemsOriginal;

      items.forEach(item => {
        const tr = document.createElement("tr");

        const savedVendorA = vendorSelections[item] || vendors[0];
        const vendorA = createDropdown(vendors, savedVendorA, (newVendor) => {
          updateVendorSelection(item, newVendor);
        });

        const itemCell = document.createElement("td");
        itemCell.textContent = item;

        const savedVendorC = Object.keys(orders).find(v => orders[v][item] !== undefined) || vendors[0];
        const vendorC = createDropdown(vendors, savedVendorC, (newVendor) => {
          updateOrder(newVendor, item, parseInt(qtyInput.value) || 0);
        });

        const savedQty = orders[savedVendorC]?.[item] || 0;
        const qtyInput = document.createElement("input");
        qtyInput.type = "number";
        qtyInput.inputMode = "numeric"; // ‚úÖ Ïà´Ïûê ÌÇ§Ìå®Îìú Ïú†ÎèÑ
        qtyInput.min = "0";
        qtyInput.value = savedQty;
        qtyInput.oninput = () => {
          const val = parseInt(qtyInput.value);
          updateOrder(vendorC.value, item, isNaN(val) || val < 0 ? 0 : val);
        };

        tr.appendChild(createCell(vendorA));
        tr.appendChild(createCell(itemCell));
        tr.appendChild(createCell(vendorC));
        tr.appendChild(createCell(qtyInput));

        tbody.appendChild(tr);
      });
    }

    function createCell(content) {
      const td = document.createElement("td");
      td.appendChild(content);
      return td;
    }

    function goToOrders() {
      window.location.href = "orders.html";
    }

    function clearVendorAndQty() {
      orders = {};
      localStorage.setItem("orders", JSON.stringify(orders));
      location.reload();
    }

    function toggleRowSort() {
      useSortedRows = !useSortedRows;
      initTable();
    }

    initTable();
  </script>
</body>
</html>