<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ëª¨ë°”ì¼ ì£¼ë¬¸ ì•±</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">

  <style>
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; margin: 0; padding: 10px; background: #f9f9f9; }
    header {
      position: sticky; top: 0; background: white; z-index: 100; padding: 10px;
      display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #ccc; flex-wrap: wrap;
    }
    h1 { font-size: 18px; margin: 0; }
    .btn { font-size: 15px; padding: 8px 12px; margin: 5px; border: none; background: #007aff; color: white; border-radius: 6px; cursor: pointer; }
    .btn:hover { background: #005bb5; }
    table { width: 100%; border-collapse: collapse; font-size: 14px; margin-top: 10px; background: white; }
    th, td { border: 1px solid #ccc; padding: 8px; vertical-align: middle; }
    select, input[type="number"] { width: 100%; padding: 6px; font-size: 14px; border-radius: 4px; border: 1px solid #ccc; }
    input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    .sort-btn { font-size: 13px; padding: 4px 8px; margin-left: 6px; border: none; background: #eee; border-radius: 4px; cursor: pointer; }
    .vendor-header { display: flex; align-items: center; justify-content: space-between; gap: 8px; flex-wrap: wrap; }

    /* modal */
    .modal {
      display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5);
      justify-content: center; align-items: center; z-index: 200;
    }
    .modal-content {
      background: white; padding: 20px; border-radius: 8px; width: 92%; max-width: 420px;
      max-height: 90vh; overflow-y: auto;
    }
    .row {
      display: flex; gap: 8px; margin-bottom: 8px;
    }
    /* draggable rows cursor & style */
    .row[draggable="true"] { cursor: grab; }
    .row.dragging { opacity: 0.5; }
    .row input[type="text"] { flex: 1; padding: 8px; border: 1px solid #ccc; border-radius: 6px; }
    .icon-btn { background: #eee; color: #333; border: 1px solid #ddd; border-radius: 6px; padding: 6px 10px; cursor: pointer; }
    .icon-btn:hover { background: #ddd; }
    .footer { display: flex; justify-content: space-between; gap: 8px; margin-top: 10px; }
    .muted { color: #666; font-size: 12px; margin-top: 6px; }

    @media (max-width: 480px) {
  th, td { font-size: 13px; padding: 6px; }
  h1 { font-size: 16px; }
  .btn { font-size: 14px; padding: 6px 10px; }
  .sort-btn { font-size: 12px; padding: 3px 6px; }

  /* ğŸ“± ëª¨ë°”ì¼ í…Œì´ë¸” ì—´ ë„ˆë¹„ ì¡°ì • */
  #orderTable td:nth-child(1),  /* ì¶”ì²œ ë²¤ë” */
  #orderTable th:nth-child(1) {
    width: 80px;
  }

  #orderTable td:nth-child(2),  /* í’ˆëª© */
  #orderTable th:nth-child(2) {
    width: auto;
  }

  #orderTable td:nth-child(3),  /* ì‹¤ì œ ë²¤ë” */
  #orderTable th:nth-child(3) {
    width: 70px;
  }

  #orderTable td:nth-child(4),  /* ìˆ˜ëŸ‰ */
  #orderTable th:nth-child(4) {
    width: 70px;
  }

  /* ìˆ˜ëŸ‰ input ë„ˆë¹„ ê³ ì • */
  input[type="number"] {
    width: 100%;
    min-width: 60px;
    max-width: 70px;
  }

  /* ë²¤ë” select ë„ˆë¹„ ê³ ì • */
  select {
    min-width: 60px;
    max-width: 70px;
  }
}
  </style>
</head>
<body>
  <header>
    <h1>ëª¨ë°”ì¼ ì£¼ë¬¸ ì•±</h1>
    <div>
      <button class="btn" onclick="goToOrders()">ğŸ“‹ ì£¼ë¬¸ ë‚´ì—­ ë³´ê¸°</button>
      <button class="btn" onclick="clearOrders()">ğŸ§¹ í´ë¦¬ì–´</button>
      <button class="btn" onclick="openVendorSettings()">âš™ï¸ ë²¤ë” ì„¤ì •</button>
      <button class="btn" onclick="openItemSettings()">ğŸ“¦ í’ˆëª© ì„¤ì •</button>
    </div>
  </header>

  <table id="orderTable">
    <thead>
      <tr>
        <th>
          <div class="vendor-header">
            ì¶”ì²œ ë²¤ë”
            <button class="sort-btn" id="sortToggleBtn" onclick="toggleRowSort()" title="ì •ë ¬ í† ê¸€">ğŸ”½</button>
          </div>
        </th>
        <th>í’ˆëª©</th>
        <th>ë²¤ë”</th>
        <th>ìˆ˜ëŸ‰</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>

  <!-- ë²¤ë” ì„¤ì • ëª¨ë‹¬ -->
  <div class="modal" id="settingsModal" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
    <div class="modal-content">
      <h2 id="settingsTitle">ë²¤ë” ì„¤ì •</h2>
      <div id="vendorList" class="muted">ë²¤ë”ë¥¼ ì¶”ê°€í•˜ê±°ë‚˜ ì´ë¦„ì„ ìˆ˜ì •í•˜ì„¸ìš”.</div>
      <div class="row" style="margin-top:10px;">
        <input id="newVendorInput" type="text" placeholder="ìƒˆ ë²¤ë” ì´ë¦„ ì…ë ¥">
        <button class="icon-btn" onclick="addVendor()">â• ì¶”ê°€</button>
      </div>
      <div class="footer">
        <button class="icon-btn" onclick="resetVendors()">â†©ï¸ ê¸°ë³¸ê°’ ë³µì›</button>
        <div style="margin-left:auto; display:flex; gap:8px;">
          <button class="icon-btn" onclick="closeVendorSettings()">ë‹«ê¸°</button>
        </div>
      </div>
      <div class="muted">ì‚­ì œ ì‹œ í•´ë‹¹ ë²¤ë”ì˜ ì£¼ë¬¸ì€ ì œê±°ë©ë‹ˆë‹¤.</div>
    </div>
  </div>

  <!-- í’ˆëª© ì„¤ì • ëª¨ë‹¬ -->
  <div class="modal" id="itemModal" role="dialog" aria-modal="true" aria-labelledby="itemTitle">
    <div class="modal-content">
      <h2 id="itemTitle">í’ˆëª© ì„¤ì •</h2>
      <div id="itemList" class="muted">í’ˆëª©ì„ ì¶”ê°€í•˜ê±°ë‚˜ ì´ë¦„ì„ ìˆ˜ì •í•˜ì„¸ìš”. ë“œë˜ê·¸ í•´ì„œ ìˆœì„œë¥¼ ë°”ê¿€ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
      <div class="row" style="margin-top:10px;">
        <input id="newItemInput" type="text" placeholder="ìƒˆ í’ˆëª© ì´ë¦„ ì…ë ¥">
        <button class="icon-btn" onclick="addItem()">â• ì¶”ê°€</button>
      </div>
      <div class="footer">
        <button class="icon-btn" onclick="resetItems()">â†©ï¸ ê¸°ë³¸ê°’ ë³µì›</button>
        <div style="margin-left:auto; display:flex; gap:8px;">
          <button class="icon-btn" onclick="closeItemSettings()">ë‹«ê¸°</button>
        </div>
      </div>
      <div class="muted">ì‚­ì œ ì‹œ í•´ë‹¹ í’ˆëª©ì˜ ëª¨ë“  ì£¼ë¬¸ê³¼ ì¶”ì²œ ë²¤ë” ì„¤ì •ì´ ì œê±°ë©ë‹ˆë‹¤.</div>
    </div>
  </div>

  <script>
    // ê¸°ë³¸ê°’
    const DEFAULT_VENDORS = [
      "","M","N","R",
      "S","W","H"
    ];
    const DEFAULT_ITEMS = [
      "Tuna Blue fin","Tuna Yellow Fin","Ground Tuna","Escolar","Smoked Salmon",
      "Unagi","Sushi Ebi","Octopus","Chashu","Naruto Maki","Green Mussel","Ikura",
      "Tobiko(orange)","Tamago","Kani","Sime Saba","Baby Scallop","Ama Ebi","Ika",
      "Hokkigai","Snow Crab Leg","Tsubugai","Inari","Scallop 3s","Salmon",
      "Yellowtail","Albacore Tuna","Uni","Madai","",
      "Gyoza Veggi","Gyoza Chicken","Gyoza Pork","Gyoza Beef","Seaweed Salad","Squid Salad",
      "Osaki Shred","Soba Noodle","Udon Noodle","Ramen Noodle","Pork Loin","Chicken Breast",
      "Shrimp 21-25","Shrimp 71-90","Nobashi Shrimp","Soft Shell Crab Prime","Craw Fish",
      "Salmon Teriyaki 8oz","Calamari","",
	"Sushi Nori Half","Sushi Nori Full","Soy Paper","Shichimi","Eel Sauce","Sriracha","Rayu","Yuzu",
	"Tsuyu","Ponzu","Vinegar","Japanese Dressing","Yakisoba Sauce","Tonkatsu Sauce","Hondashi",
	"Katsuo ìœ¡ìˆ˜","Katsuo ë°ì½”","Kizami","Furikake","Wasabi","Karrage Powder","Sweet Chilli Sauce",
	"Sesame Oil","Sea Salt","Black Pepper","Cajun Powder","Baking Spray","Lemon Juice 1Gal","Mayo",
	"ì¹´ë ˆ ê°€ë£¨","",
        "Mirin","KD-39","Shiragiku Vinegar","Miso Soup Base","Soy Sauce 5gal","Oil","Sugar",
	"Salt","Constachi","Panko","Tempurako","Sushi Rice","","Edamame","Shrimp Shumai","Takoyaki",
	"Breaded Oyster","Ika Geso","Spring Roll","Corn","",
        "Avocado","Onion","Red Onion","Sushi Ginger","Cream Cheese","Cucumber","Green Onion","Lemon",
	"Carrot","Jalapeno","Tonkotsu Ramen Base","Miso Ramen Base","Lettuce","Broccoli","Mushroom","Egg",
	"Aquamar","Kanpyo","Yama Gobo","Fukujin","Rakkyo","ë‹¤ì§„ ë§ˆëŠ˜","Butter","Magarin","",
        "Food Plastic Film 12","Food Plastic Film 18","Wax Paper","ì€ë°•ì§€ 12X10.75","ì‘¤ì„¸ë¯¸","ì²  ì‘¤ì„¸ë¯¸",
	"ì£¼ë°© ë¹„ë‹ ì¥ê°‘","í”„ë© ë¹„ë‹ë°± 6x3x15","Toilet Paper","Hand Tower","Windex","Dish Soap Pink",
	"Crolox","í™”ì¥ì‹¤ ì²­ì†Œ ìŠ¤í‹±","Trash Bag 38-59","Trash Bag 33-39","Fabuloso","Degreaser","Hand Soap","Bounty","",
	"Sauce Cup 2oz","Sushi Togo Box A01","Sushi Togo Box A02","Sushi Togo Box A03","Donburi Togo Box",
	"Bento Togo Box","Raman Togo Box","ë¯¸ì†Œíˆ¬ê³  10oz","ë¬¼ íˆ¬ê³ ì»µ 16oz","ìƒëŸ¬ë“œíˆ¬ê³  íˆ¬ëª… 8oz","í°íˆ¬ê³ ë°•ìŠ¤ 3ì¹¸",
	"íˆ¬ê³  í°ì»µ 32oz","ë°¥ íˆ¬ê³ ë°•ìŠ¤","ì¥ì–´ ë®ë°¥ íˆ¬ê³  28oz","ì¼€ìµ íˆ¬ê³ ë°•ìŠ¤ 38oz","",
	"Paper Bag #2","Paper Bag #16","Paper Bag #20","Plastic Bag","Togo Spoon","Togo Fork","Togo Knife",
	"Straw","Napkin","Chopstick","Soy Sauce Packet","Light soy sauce Packet","Wakame","Sweet N Low","",
	"Ramune Original","Ramune Strawberry","Ramune grape","Ramune Melon","Calpico Original",
	"Calpico Strawberry","Calpico White Peach","Calpico Melon","Calpico Mango","Coke","Diet Coke","Zero Coke",
	"Sprite","Dr.Pepper","Fanta","Root Beer","Bottle Water","Toco Chico","Perrier","Milk","Milk Choco",
	"Orange Juice","Apple Juice","Green Tea Bottle","Jasmine Tea Bottle","Grean tea","Jasmine Tea","Ice Tea","",
	"ê³ êµ¬ë§ˆ","í˜¸ë°•","ë¬´","ìƒê°•","ë‘ë¶€ Red","ë‘ë¶€ Green","ë‹¨ë¬´ì§€","ì‚¬ê³¼","ì–‘ë°°ì¶”","ë°°ì¶”","ê½ˆë¦¬ê³ ì¶”","ì„¸ë¼ë‡¨","ë¶ˆê³ ê¸°",
	"ë¶ˆê³ ê¸° ì†ŒìŠ¤","ë§Œë‘í”¼","ëª©ì¥ê°‘","ë‹¤ì‹œë§ˆ","ë¶€íƒ„ê°€ìŠ¤","ë¼ì´ìŠ¤ íŒ¨ì´í¼","ë˜ë ì•„","ì•„ìŠ¤íŒŒë¼ê±°ìŠ¤","ë§ê³ ","Ziplock",
	"Olive Oil (extra)","Creme Brulee","Mochi","Oreo","Sushi Glove S","Sushi Glove M","Bamboo Leaf","Galic Flake","Tenkasu","",
    ];

    // ìƒíƒœ
    let vendors = [], items = [], orders = {}, vendorSelections = {}, useSortedRows = true;
    let dragSrcIndex = null;

    // ë¡œë“œ/ì €ì¥
    function loadState(){
      vendors = JSON.parse(localStorage.getItem("vendors") || JSON.stringify(DEFAULT_VENDORS));
      items   = JSON.parse(localStorage.getItem("items")   || JSON.stringify(DEFAULT_ITEMS));
      orders  = JSON.parse(localStorage.getItem("orders")  || "{}");
      vendorSelections = JSON.parse(localStorage.getItem("vendorSelections") || "{}");
      useSortedRows    = JSON.parse(localStorage.getItem("useSortedRows")    || "true");
      if(!vendors.length) vendors = [...DEFAULT_VENDORS];
      if(!items.length)   items   = [...DEFAULT_ITEMS];
    }
    function saveVendors(){ localStorage.setItem("vendors", JSON.stringify(vendors)); }
    function saveItems()  { localStorage.setItem("items",   JSON.stringify(items));   }
    function saveOrders() { localStorage.setItem("orders",  JSON.stringify(orders));  }
    function saveVendorSelections(){ localStorage.setItem("vendorSelections", JSON.stringify(vendorSelections)); }
    function saveUseSortedRows(){ localStorage.setItem("useSortedRows", JSON.stringify(useSortedRows)); }

    // ë“œë¡­ë‹¤ìš´ ìƒì„±
    function createDropdown(options, defaultVal="", onChange=null){
      const sel = document.createElement("select");
      options.forEach(o=>{
        const opt = document.createElement("option");
        opt.value = o; opt.textContent = o;
        sel.appendChild(opt);
      });
      if(!options.includes(defaultVal)) defaultVal = options[0];
      sel.value = defaultVal;
      if(onChange) sel.onchange = ()=> onChange(sel.value);
      return sel;
    }

    // ì£¼ë¬¸ í¸ì§‘
    function setOrder(vendor,item,qty){
      if(qty <= 0){
        if(orders[vendor]){
          delete orders[vendor][item];
          if(!Object.keys(orders[vendor]).length) delete orders[vendor];
        }
      } else {
        if(!orders[vendor]) orders[vendor] = {};
        orders[vendor][item] = qty;
      }
      saveOrders();
    }
    function setVendorSelection(item,vendor){
      vendorSelections[item] = vendor;
      saveVendorSelections();
      if(useSortedRows) initTable();
    }

    // í…Œì´ë¸” ì •ë ¬ ê¸°ì¤€ ê°€ì ¸ì˜¤ê¸°
    function sortedItems(){
      return [...items].sort((a,b)=>{
        const va = vendorSelections[a]||"", vb = vendorSelections[b]||"";
        if(va === vb) return a.localeCompare(b);
        return va.localeCompare(vb);
      });
    }
    function currentVendorForItem(item){
      const ov = Object.keys(orders).find(v=> orders[v]?.[item]!==undefined );
      const rv = vendorSelections[item];
      if(ov && vendors.includes(ov)) return ov;
      if(rv && vendors.includes(rv)) return rv;
      return vendors[0];
    }

    // ë©”ì¸ í…Œì´ë¸” ë Œë”ë§
    function initTable(){
      loadState();
      const tbody = document.getElementById("tableBody");
      tbody.innerHTML = "";
      const list = useSortedRows ? sortedItems() : items;
      document.getElementById("sortToggleBtn")
 	 .textContent = useSortedRows ? "ğŸ”½" : "ğŸ”¼";

      list.forEach(item=>{
        const tr = document.createElement("tr");

        // ì¶”ì²œ ë²¤ë”
        const rec = vendorSelections[item]||vendors[0];
        const selRec = createDropdown(vendors, rec, v=> setVendorSelection(item,v));
        const tdA = document.createElement("td"); tdA.appendChild(selRec);

        // í’ˆëª©ëª…
        const tdB = document.createElement("td"); tdB.textContent = item;

        // ì‹¤ì œ ë²¤ë” & ìˆ˜ëŸ‰
        const cv = currentVendorForItem(item);
        const savedQty = orders[cv]?.[item]||0;
        const selAct = createDropdown(vendors, cv);
        selAct.onchange = ()=>{
          // ë‹¤ë¥¸ ë²¤ë”ì— ë‚¨ì•„ìˆëŠ” ë™ì¼í’ˆëª© ì œê±°
          Object.keys(orders).forEach(v=>{
            if(v!==selAct.value && orders[v]?.[item]!==undefined){
              delete orders[v][item];
              if(!Object.keys(orders[v]).length) delete orders[v];
            }
          });
          setOrder(selAct.value, item, Number(inputQty.value)||0);
        };
        const tdC = document.createElement("td"); tdC.appendChild(selAct);

        const inputQty = document.createElement("input");
        inputQty.type="number"; inputQty.min="0"; inputQty.step="1";
        inputQty.placeholder="0"; inputQty.inputMode="numeric";
        inputQty.value = savedQty;
        inputQty.onfocus = ()=> inputQty.select();
        inputQty.oninput = ()=>{
          let v = Number(inputQty.value);
          if(isNaN(v)||v<0) v=0;
          inputQty.value = v;
          setOrder(selAct.value, item, v);
        };
        const tdD = document.createElement("td"); tdD.appendChild(inputQty);

        [tdA,tdB,tdC,tdD].forEach(td=> tr.appendChild(td));
        tbody.appendChild(tr);
      });
    }

    // ë²„íŠ¼ ì•¡ì…˜
    function toggleRowSort(){ useSortedRows = !useSortedRows; saveUseSortedRows(); initTable(); }
    function goToOrders(){ window.location.href = "orders.html"; }
    function clearOrders(){
      if(!confirm("ëª¨ë“  ìˆ˜ëŸ‰ì„ í´ë¦¬ì–´í• ê¹Œìš”? (ì¶”ì²œ ë²¤ë”/í’ˆëª© ì„¤ì •ì€ ìœ ì§€ë©ë‹ˆë‹¤)")) return;
      orders = {}; saveOrders();
      initTable();
    }

    // ë²¤ë” ì„¤ì • modal
    function openVendorSettings(){
      loadState();
      document.getElementById("settingsModal").style.display = "flex";
      renderVendorList();
      document.addEventListener("keydown", escCloseVendorOnce);
      document.getElementById("settingsModal").addEventListener("click", backdropCloseVendorOnce);
    }
    function closeVendorSettings(){
      document.getElementById("settingsModal").style.display = "none";
      document.removeEventListener("keydown", escCloseVendorOnce);
      document.getElementById("settingsModal").removeEventListener("click", backdropCloseVendorOnce);
    }
    function escCloseVendorOnce(e){ if(e.key==="Escape") closeVendorSettings(); }
    function backdropCloseVendorOnce(e){ if(e.target.id==="settingsModal") closeVendorSettings(); }

    function renderVendorList(){
      const wrap = document.getElementById("vendorList");
      wrap.innerHTML = "";
      if(!vendors.length) wrap.textContent="ë²¤ë”ê°€ ì—†ìŠµë‹ˆë‹¤. ì¶”ê°€í•˜ì„¸ìš”.";
      vendors.forEach(name=>{
        const row = document.createElement("div"); row.className="row";
        const inp = document.createElement("input"); inp.type="text"; inp.value=name;
        inp.onchange = ()=> renameVendor(name, inp.value.trim());
        const btn = document.createElement("button"); btn.className="icon-btn"; btn.textContent="ğŸ—‘ï¸";
        btn.onclick = ()=> deleteVendor(name);
        row.appendChild(inp);
        if(vendors.length>1) row.appendChild(btn);
        wrap.appendChild(row);
      });
    }
    function addVendor(){
      const inp = document.getElementById("newVendorInput");
      const name = (inp.value||"").trim(); if(!name) return;
      if(vendors.includes(name)){ alert("ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤."); return; }
      vendors.push(name); saveVendors(); inp.value="";
      renderVendorList(); initTable();
    }
    function renameVendor(oldN,newN){
      if(!newN){ alert("ì´ë¦„ì„ ë¹„ìš¸ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."); renderVendorList(); return; }
      if(oldN===newN) return;
      if(vendors.includes(newN)){ alert("ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤."); renderVendorList(); return; }
      const i = vendors.indexOf(oldN); if(i>=0) vendors[i]=newN;
      if(orders[oldN]){ orders[newN] = {...orders[newN], ...orders[oldN]}; delete orders[oldN]; }
      Object.keys(vendorSelections).forEach(it=>{
        if(vendorSelections[it]===oldN) vendorSelections[it]=newN;
      });
      saveVendors(); saveOrders(); saveVendorSelections();
      renderVendorList(); initTable();
    }
    function deleteVendor(name){
      if(vendors.length<=1){ alert("ë§ˆì§€ë§‰ ë²¤ë”ëŠ” ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."); return; }
      if(!confirm(`'${name}'ì„ ì‚­ì œí• ê¹Œìš”? ì£¼ë¬¸ë„ ì œê±°ë©ë‹ˆë‹¤.`)) return;
      vendors = vendors.filter(v=>v!==name);
      if(orders[name]){ delete orders[name]; saveOrders(); }
      Object.keys(vendorSelections).forEach(it=>{
        if(vendorSelections[it]===name) vendorSelections[it]=vendors[0];
      });
      saveVendors(); saveVendorSelections();
      renderVendorList(); initTable();
    }
    function resetVendors(){
      if(!confirm("ë²¤ë”ë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ë³µì›í• ê¹Œìš”?")) return;
      vendors=[...DEFAULT_VENDORS];
      Object.keys(vendorSelections).forEach(it=>{
        if(!vendors.includes(vendorSelections[it])) vendorSelections[it]=vendors[0];
      });
      saveVendors(); saveVendorSelections();
      renderVendorList(); initTable();
    }

    // í’ˆëª© ì„¤ì • modal (ë“œë˜ê·¸&ë“œë¡­)
    function openItemSettings(){
      loadState();
      document.getElementById("itemModal").style.display="flex";
      renderItemList();
      document.addEventListener("keydown", escCloseItemOnce);
      document.getElementById("itemModal").addEventListener("click", backdropCloseItemOnce);
    }
    function closeItemSettings(){
      document.getElementById("itemModal").style.display="none";
      document.removeEventListener("keydown", escCloseItemOnce);
      document.getElementById("itemModal").removeEventListener("click", backdropCloseItemOnce);
    }
    function escCloseItemOnce(e){ if(e.key==="Escape") closeItemSettings(); }
    function backdropCloseItemOnce(e){ if(e.target.id==="itemModal") closeItemSettings(); }

    function renderItemList(){
  const wrap = document.getElementById("itemList");
  wrap.innerHTML = "";
  if(!items.length) wrap.textContent="í’ˆëª©ì´ ì—†ìŠµë‹ˆë‹¤. ì¶”ê°€í•˜ì„¸ìš”.";
  items.forEach((name, idx)=>{
    const row = document.createElement("div");
    row.className = "row";
    row.draggable = true;
    row.dataset.index = idx;

    // ë“œë˜ê·¸ ì´ë²¤íŠ¸
    row.addEventListener("dragstart", e=>{
      dragSrcIndex = idx;
      row.classList.add("dragging");
    });
    row.addEventListener("dragend", e=>{
      row.classList.remove("dragging");
    });
    row.addEventListener("dragover", e=> e.preventDefault());
    row.addEventListener("drop", e=>{
      e.preventDefault();
      const dst = Number(row.dataset.index);
      if(dragSrcIndex !== null && dragSrcIndex !== dst){
        const moved = items.splice(dragSrcIndex, 1)[0];
        items.splice(dst, 0, moved);
        saveItems();
        renderItemList();
        initTable();
      }
      dragSrcIndex = null;
    });

    // í’ˆëª© ì´ë¦„ ì…ë ¥
    const inp = document.createElement("input");
    inp.type="text"; inp.value=name; inp.placeholder="í’ˆëª© ì´ë¦„";
    inp.onchange = ()=> renameItem(name, inp.value.trim());

    // ì‚­ì œ ë²„íŠ¼
    const btnDel = document.createElement("button");
    btnDel.className="icon-btn"; btnDel.textContent="ğŸ—‘ï¸";
    btnDel.onclick = ()=> deleteItem(name);

    // ìœ„ë¡œ ì´ë™ ë²„íŠ¼
    const btnUp = document.createElement("button");
    btnUp.className="icon-btn"; btnUp.textContent="â¬†ï¸";
    btnUp.onclick = ()=>{
      if(idx > 0){
        const temp = items[idx];
        items[idx] = items[idx - 1];
        items[idx - 1] = temp;
        saveItems();
        renderItemList();
        initTable();
      }
    };

    // ì•„ë˜ë¡œ ì´ë™ ë²„íŠ¼
    const btnDown = document.createElement("button");
    btnDown.className="icon-btn"; btnDown.textContent="â¬‡ï¸";
    btnDown.onclick = ()=>{
      if(idx < items.length - 1){
        const temp = items[idx];
        items[idx] = items[idx + 1];
        items[idx + 1] = temp;
        saveItems();
        renderItemList();
        initTable();
      }
    };

    row.appendChild(inp);
    if(items.length > 1){
      row.appendChild(btnUp);
      row.appendChild(btnDown);
      row.appendChild(btnDel);
    }
    wrap.appendChild(row);
  });
}
    function addItem(){
      const inp = document.getElementById("newItemInput");
      const name = (inp.value||"").trim(); if(!name) return;
      if(items.includes(name)){ alert("ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤."); return; }
      items.push(name); saveItems(); inp.value="";
      renderItemList(); initTable();
    }
    function renameItem(oldN,newN){
      if(!newN){ alert("ì´ë¦„ì„ ë¹„ìš¸ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."); renderItemList(); return; }
      if(oldN===newN) return;
      if(items.includes(newN)){ alert("ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤."); renderItemList(); return; }
      const i = items.indexOf(oldN); if(i>=0) items[i]=newN;
      // orders í‚¤
      Object.keys(orders).forEach(v=>{
        if(orders[v]?.[oldN]!==undefined){
          orders[v][newN] = orders[v][oldN];
          delete orders[v][oldN];
          if(!Object.keys(orders[v]).length) delete orders[v];
        }
      });
      // selections í‚¤
      if(vendorSelections[oldN]!==undefined){
        vendorSelections[newN] = vendorSelections[oldN];
        delete vendorSelections[oldN];
      }
      saveItems(); saveOrders(); saveVendorSelections();
      renderItemList(); initTable();
    }
    function deleteItem(name){
      if(items.length<=1){ alert("ë§ˆì§€ë§‰ í’ˆëª©ì€ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."); return; }
      if(!confirm(`'${name}'ì„ ì‚­ì œí• ê¹Œìš”?`)) return;
      items = items.filter(i=>i!==name);
      // orders
      Object.keys(orders).forEach(v=>{
        if(orders[v]?.[name]!==undefined){
          delete orders[v][name];
          if(!Object.keys(orders[v]).length) delete orders[v];
        }
      });
      // selections
      if(vendorSelections[name]!==undefined) delete vendorSelections[name];
      saveItems(); saveOrders(); saveVendorSelections();
      renderItemList(); initTable();
    }
    function resetItems(){
      if(!confirm("í’ˆëª©ì„ ê¸°ë³¸ê°’ìœ¼ë¡œ ë³µì›í• ê¹Œìš”?")) return;
      items = [...DEFAULT_ITEMS];
      Object.keys(vendorSelections).forEach(k=>{
        if(!items.includes(k)) delete vendorSelections[k];
      });
      Object.keys(orders).forEach(v=>{
        Object.keys(orders[v]).forEach(k=>{
          if(!items.includes(k)) delete orders[v][k];
        });
        if(!Object.keys(orders[v]).length) delete orders[v];
      });
      saveItems(); saveVendorSelections(); saveOrders();
      renderItemList(); initTable();
    }

    // ì´ˆê¸° ì‹¤í–‰
    loadState();
    initTable();

if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/service-worker.js')
        .then(() => console.log('âœ… Service Worker registered'))
        .catch(error => console.error('âŒ Registration failed:', error));
    }


  </script>
</body>
</html>